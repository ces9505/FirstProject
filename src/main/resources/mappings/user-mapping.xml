<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="UserDAO">
	<resultMap type="user" id="userResult">
		<id property="userid" column="USERID" />
		<id property="userpw" column="USERPW" />
		<id property="score" column="SCORE" />
		<id property="name" column="NAME" />
		<id property="time" column="TIME" />
		<id property="email" column="EMAIL" />
		<id property="phone" column="PHONE" />
		<id property="level" column="LEVEL" />
		<id property="blockdate" column="BLOCKDATE" />
		<id property="remarks" column="REMARKS" />
	</resultMap>
	<insert id="insertUser" parameterType="user">
		
		<![CDATA[
		INSERT INTO USER(USERID,USERPW,NAME,EMAIL,PHONE,LEVEL)
		VALUES(#{userid},#{userpw},#{name},#{email},#{phone},#{level})
		]]>
	</insert>
	<select id="getUser" resultType="user">
		
		<![CDATA[
			SELECT * FROM USER WHERE USERID=#{userid} AND USERPW=#{userpw} 
		]]>


	</select>
	<select id="getUserList" resultMap="userResult">

		<if test="level == 0">
			<![CDATA[
				SELECT * FROM USER WHERE LEVEL=0 AND BLOCKDATE < current_timestamp
			]]>
		</if>
		<if test="level == 1">
			<![CDATA[
				SELECT * FROM USER WHERE LEVEL=1 AND BLOCKDATE < current_timestamp
			]]>
		</if>
		<if test="level == 9">
			<![CDATA[
				SELECT * FROM USER WHERE BLOCKDATE >= current_timestamp
			]]>
		</if>
	</select>


	<update id="updateUser">
	<![CDATA[
			UPDATE USER SET USERPW=#{userpw}, NAME=#{name},EMAIL=#{email},PHONE=#{phone} WHERE USERID=#{userid}
		]]>

	</update>

	<update id="updateUserBlock">

		<if test="blockdate==1">
	<![CDATA[
			UPDATE USER
			SET BLOCKDATE = DATE(DATE_ADD(CURRENT_TIMESTAMP, INTERVAL 2 DAY)),REMARKS = #{remarks}
			WHERE USERID = #{userid}
		]]>
		</if>
		<if test="blockdate==3">
	<![CDATA[
			UPDATE USER
			SET BLOCKDATE = DATE(DATE_ADD(CURRENT_TIMESTAMP, INTERVAL 4 DAY)),REMARKS = #{remarks}
			WHERE USERID = #{userid}
		]]>
		</if>
		<if test="blockdate==7">
	<![CDATA[
			UPDATE USER
			SET BLOCKDATE = DATE(DATE_ADD(CURRENT_TIMESTAMP, INTERVAL 8 DAY)),REMARKS = #{remarks}
			WHERE USERID = #{userid}
		]]>
		</if>


	</update>
	<update id="userClearBlock">
	<![CDATA[
	UPDATE USER
	SET BLOCKDATE = CURDATE(), REMARKS = #{remarks}
	WHERE USERID = #{userid}
	]]>



	</update>


	<delete id="deleteUser">
	
	<![CDATA[
			DELETE FROM USER WHERE USERID =#{userid}
		]]>
	</delete>

</mapper>
